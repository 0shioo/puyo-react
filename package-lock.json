import React, { useState, useEffect } from "react";
import "./App.css";

const ROWS = 12;
const COLS = 6;
const COLORS = ["red", "green", "blue", "yellow", "purple"];

function App() {
  const [field, setField] = useState(
    Array.from({ length: ROWS }, () => Array(COLS).fill(null))
  );
  const [currentPuyo, setCurrentPuyo] = useState({
    color: [randomColor(), randomColor()],
    pos: [0, Math.floor(COLS / 2)]
  });

  useEffect(() => {
    const timer = setInterval(() => {
      moveDown();
    }, 500);
    return () => clearInterval(timer);
  }, [currentPuyo, field]);

  const moveDown = () => {
    const [r, c] = currentPuyo.pos;
    if (r + 2 < ROWS && !field[r + 2][c]) {
      setCurrentPuyo({ ...currentPuyo, pos: [r + 1, c] });
    } else {
      fixPuyo();
    }
  };

  const fixPuyo = () => {
    const newField = field.map(row => [...row]);
    const [r, c] = currentPuyo.pos;
    newField[r][c] = currentPuyo.color[0];
    if (r + 1 < ROWS) newField[r + 1][c] = currentPuyo.color[1];
    setField(newField);
    setCurrentPuyo({ color: [randomColor(), randomColor()], pos: [0, Math.floor(COLS / 2)] });
  };

  return (
    <div className="game">
      {field.map((row, r) => (
        <div key={r} className="row">
          {row.map((cell, c) => (
            <div key={c} className="cell">
              {cell && <div className="puyo" style={{ backgroundColor: cell }} />}
            </div>
          ))}
        </div>
      ))}
    </div>
  );
}

function randomColor() {
  return COLORS[Math.floor(Math.random() * COLORS.length)];
}

export default App;
